<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Salvador ❤ Assunção</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">

<style>

:root{
  --pink:#d6336c;
  --bg1:#fff6f8;
  --bg2:#fff;
  --text:#222;
  --muted:#6b5860;
  --card:#ffffffdd;
  --shadow:0 6px 20px rgba(0,0,0,0.06);
}

/* RESET */
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:Inter,Arial,sans-serif;
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  color:var(--text);
  min-height:100vh;
  -webkit-font-smoothing:antialiased;
}

/* TOPBAR */
.topbar{
  position:fixed;
  top:0;left:0;right:0;
  height:64px;
  background:#ffffffdd;
  backdrop-filter:blur(6px);
  border-bottom:1px solid #0001;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 18px;
  z-index:2000;
}
.brand{
  font-weight:800;
  font-size:18px;
  color:var(--pink);
}
.currentPageName{
  font-weight:700;
  font-size:15px;
  color:var(--muted);
  margin-left:14px;
}
.hamb{
  padding:8px 12px;
  border-radius:10px;
  border:1px solid #0002;
  background:#fff;
  cursor:pointer;
}

/* DRAWER */
#drawerBg{
  display:none;
  position:fixed;inset:0;
  background:#0005;
  z-index:1500;
}
#drawer{
  position:fixed;
  top:0;right:-320px;
  width:320px;
  height:100vh;
  background:#fff;
  padding:20px;
  box-shadow:-10px 0 25px #0003;
  z-index:2001;
  transition:.25s ease;
}
.menuitem{
  padding:12px;
  font-weight:700;
  color:#333;
  cursor:pointer;
  border-radius:8px;
}
.menuitem:hover{background:#fff1f7}

/* CONTAINER */
.container{
  max-width:900px;
  padding:90px 18px 40px;
  margin:auto;
}
.card{
  background:var(--card);
  padding:20px;
  border-radius:16px;
  box-shadow:var(--shadow);
  margin-bottom:22px;
}

.page{display:none}
.page.active{display:block}

/* HOME */
.digitalClock{
  font-size:56px;
  font-weight:800;
  color:var(--pink);
  text-align:center;
  margin:40px 0;
}

/* SOBRE */
.editorWrap{display:flex;gap:14px;align-items:flex-start}
.toolbar{
  width:130px;
  padding:12px;
  background:#fff;
  border-radius:12px;
  border:1px solid #eee;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.toolbar label{font-size:12px;color:var(--muted)}
.toolbar button{
  padding:6px;border:1px solid #0002;
  border-radius:6px;cursor:pointer;background:#fff;
}
.editorBox{
  flex:1;background:#fff;border-radius:12px;
  border:1px solid #eee;padding:14px;
}
.editable{
  outline:none;
  min-height:160px;
  max-height:200px;
  overflow:auto;
  font-size:16px;
  line-height:1.38;
}

/* GALERIA */
.gallery{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(110px,1fr));
  gap:10px;margin-top:12px;
}
.thumb{
  width:100%;height:110px;object-fit:cover;border-radius:10px;
}

/* NOTAS */
.notesGrid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
  gap:14px;margin-top:16px;
}
.noteCard{
  background:#fff;border-radius:12px;border:1px solid #eee;padding:14px;
}

/* CALENDÁRIO */
.calHeader{
  display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;
}
.calGrid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:8px;
}
.day{
  text-align:center;
  background:#fff;
  padding:12px;
  border-radius:10px;
  border:1px solid #eee;
  cursor:pointer;
}
.day.active{background:#ffd9e7}

/* TEMPO */
.bigDate{
  font-size:28px;
  color:var(--pink);
  font-weight:800;
  text-align:center;
}
.smallTime{
  text-align:center;
  font-weight:700;
  margin-top:6px;
  color:var(--muted);
}
.sep{
  height:1px;
  background:linear-gradient(90deg,transparent,#ddd,transparent);
  margin:16px 0;
}

</style>
</head>
<div class="topbar">
  <div style="display:flex;align-items:center">
    <div class="brand">Salvador ❤ Assunção</div>
    <div id="currentPageName" class="currentPageName"></div>
  </div>
  <button id="hamb" class="hamb">☰</button>
</div>

<!-- Drawer -->
<div id="drawerBg"></div>
<div id="drawer">
  <button id="closeDrawer" class="hamb">✖</button>
  <h3 style="margin:14px 0;color:var(--pink)">Menu</h3>
  <div class="menuitem" data-page="home">Página Inicial</div>
  <div class="menuitem" data-page="come">Onde tudo começou</div>
  <div class="menuitem" data-page="sobre">Sobre Nós</div>
  <div class="menuitem" data-page="gal">Galeria</div>
  <div class="menuitem" data-page="notas">Notas</div>
  <div class="menuitem" data-page="cal">Calendário</div>
  <div class="menuitem" data-page="tempo">Tempo</div>
</div>

<div class="container">

<!-- LOGIN -->
<div id="loginCard" class="card" style="max-width:460px;margin:auto">
  <h2 style="color:var(--pink)">Entrar</h2>
  <p class="note">Coloca aqui o código secreto</p>
  <input id="codeInput" placeholder="escreve o código..." style="width:100%;padding:12px;border:1px solid #eee;border-radius:10px">
  <button id="enterBtn" class="hamb" style="width:100%;margin-top:10px;background:var(--pink);color:#fff;border:0">Entrar</button>
  <div id="loginError" style="display:none;color:#c00;margin-top:10px">Código errado!</div>
  <p class="note">Dica: <strong>sasiboy</strong></p>
</div>

<!-- APP -->
<div id="app" style="display:none">

<!-- HOME -->
<section id="page_home" class="page active">
  <div class="card">
    <div id="digitalClock" class="digitalClock">--:--:--</div>
  </div>
</section>

<!-- ONDE TUDO COMEÇOU -->
<section id="page_come" class="page">
  <div class="card">
    <h2>Onde tudo começou</h2>
    <p class="note">(Escreve mais tarde)</p>
  </div>
</section>

<!-- SOBRE NÓS -->
<section id="page_sobre" class="page">
  <div class="card">
    <h2>Sobre Nós</h2>

    <div class="editorWrap" style="margin-top:16px">
      
      <!-- TOOLBAR -->
      <div class="toolbar">
        <label>Fonte</label>
        <select id="fontFam">
          <option value="Inter">Inter</option>
          <option value="Montserrat">Montserrat</option>
          <option value="serif">Serif</option>
        </select>

        <label>Tamanho</label>
        <input id="fontSize" type="range" min="12" max="32" value="16">

        <label>Cor</label>
        <input id="fontColor" type="color" value="#222222">

        <label>Alinhamento</label>
        <button id="aLeft"><</button>
        <button id="aCenter">-</button>
        <button id="aRight">></button>
      </div>

      <!-- EDITORES -->
      <div class="editorBox">
        <h3>Sassá</h3>
        <div id="bio_left" class="editable" contenteditable="true">
          Escreve sobre ti aqui...
        </div>
      </div>

      <div class="editorBox">
        <h3>Assunção</h3>
        <div id="bio_right" class="editable" contenteditable="true">
          Escreve sobre ela aqui...
        </div>
      </div>

    </div>

    <button id="saveBios" class="hamb" style="width:100%;background:var(--pink);color:#fff;border:0;margin-top:14px">Guardar</button>
  </div>
</section>

<!-- GALERIA -->
<section id="page_gal" class="page">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h2>Galeria</h2>
      <button id="addPhotoBtn" class="hamb" style="background:var(--pink);color:#fff;border:0">+</button>
    </div>

    <input id="fileInput" type="file" accept="image/*" style="display:none">
    
    <div id="galleryGrid" class="gallery"></div>

    <p class="note">Adiciona fotos do telemóvel ou da fototeca.</p>
  </div>
</section>

<!-- NOTAS -->
<section id="page_notas" class="page">
  <div class="card">
    <div style="display:flex;align-items:center;justify-content:space-between">
      <h2 style="margin:0">Notas</h2>
      <button id="newNoteBtn" class="hamb" style="background:var(--pink);color:#fff;border:0">+ Nota</button>
    </div>

    <!-- Editor -->
    <div id="noteEditorWrap" style="display:none;margin-top:16px">
      <input id="noteTitle" placeholder="Título" style="width:100%;padding:10px;border-radius:10px;border:1px solid #eee">

      <div style="display:flex;gap:10px;margin-top:10px">
        <select id="noteSize" style="padding:8px;border-radius:8px;border:1px solid #eee">
          <option value="14">14</option>
          <option value="16" selected>16</option>
          <option value="18">18</option>
          <option value="20">20</option>
        </select>

        <input id="noteColor" type="color" value="#222222" />

        <button id="saveNote" class="hamb" style="margin-left:auto;background:var(--pink);color:#fff;border:0">
          Guardar
        </button>
      </div>

      <div id="noteEditor" contenteditable="true"
           style="margin-top:12px;padding:12px;border:1px solid #eee;border-radius:12px;min-height:140px;background:#fff;overflow:auto"></div>
    </div>

    <!-- Lista -->
    <div id="notesList" class="notesGrid"></div>
  </div>
</section>

<!-- CALENDÁRIO -->
<section id="page_cal" class="page">
  <div class="card">
    <h2>Calendário</h2>

    <div class="calHeader">
      <button id="calPrev" class="hamb">◀</button>
      <div id="calLabel" class="note"></div>
      <button id="calNext" class="hamb">▶</button>
    </div>

    <select id="calView" style="padding:8px;border-radius:8px;border:1px solid #eee;margin-bottom:10px">
      <option value="week">Semana</option>
      <option value="month">Mês</option>
      <option value="year">Ano</option>
      <option value="day">Dia</option>
    </select>

    <div id="calendarGrid" class="calGrid"></div>

    <textarea id="dayNote" placeholder="Escreve algo sobre este dia..."
              style="width:100%;margin-top:14px;min-height:100px;padding:10px;border:1px solid #eee;border-radius:10px"></textarea>

    <button id="saveDay" class="hamb" style="width:100%;margin-top:10px;background:var(--pink);color:#fff;border:0">
      Guardar Dia
    </button>
  </div>
</section>

<!-- TEMPO -->
<section id="page_tempo" class="page">
  <div class="card">
    <h2>Tempo</h2>

    <p class="note" style="text-align:center;margin-bottom:14px">
      <small>17 de setembro de 2025 às 22:00</small>
    </p>

    <div id="ymd" class="bigDate"></div>
    <div id="hms" class="smallTime"></div>

    <div class="sep"></div>

    <p id="tempoSentence" class="note" style="text-align:center"></p>
  </div>
</section>

</div> <!-- end app -->
</div> <!-- end container -->
<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>

/* ============================
      SUPABASE CONFIG
============================ */
const SUPABASE_URL = "https://qtzlyowxjqdsswyxcmzu.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF0emx5b3d4anFkc3N3eXhjbXp1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2MDc1MDUsImV4cCI6MjA4MDE4MzUwNX0.iLb7C7x-qyzY58SHd_n_Fdc2RkVy2hNBkf-n41st02c";
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* ============================
        ELEMENTOS BASE
============================ */
const loginCard = document.getElementById('loginCard');
const appDiv = document.getElementById('app');

const enterBtn = document.getElementById('enterBtn');
const codeInput = document.getElementById('codeInput');
const loginError = document.getElementById('loginError');

const hamb = document.getElementById('hamb');
const drawer = document.getElementById('drawer');
const drawerBg = document.getElementById('drawerBg');
const closeDrawer = document.getElementById('closeDrawer');

const currentPageName = document.getElementById('currentPageName');

/* ============================
        LOGIN
============================ */
enterBtn.addEventListener("click", () => {
  const v = (codeInput.value || "").trim().toLowerCase();
  if (v === "sasiboy") {
    loginError.style.display = "none";
    loginCard.style.display = "none";
    appDiv.style.display = "block";
    showPage("home");
  } else {
    loginError.style.display = "block";
  }
});

/* ============================
        MENU LATERAL
============================ */
hamb.onclick = () => {
  drawer.style.right = "0px";
  drawerBg.style.display = "block";
};
closeDrawer.onclick =
drawerBg.onclick = () => {
  drawer.style.right = "-320px";
  drawerBg.style.display = "none";
};

document.querySelectorAll(".menuitem").forEach(m =>
  m.onclick = () => {
    showPage(m.dataset.page);
    drawer.style.right = "-320px";
    drawerBg.style.display = "none";
  }
);

/* ============================
        TROCA DE PÁGINAS
============================ */
function showPage(page) {
  document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
  document.getElementById("page_" + page).classList.add("active");

  currentPageName.textContent = page.charAt(0).toUpperCase() + page.slice(1);

  if (page === "gal") loadGallery();
  if (page === "notas") loadNotes();
  if (page === "cal") renderCalendar();
  if (page === "tempo") updateTempoUI();
}

/* ============================
        RELÓGIO HOME
============================ */
function updateClock() {
  document.getElementById("digitalClock").textContent =
    new Date().toLocaleTimeString("pt-PT");
}
setInterval(updateClock, 1000);
updateClock();

/* ============================
    SOBRE NÓS – EDITOR LIVE
============================ */
const bioLeft = document.getElementById("bio_left");
const bioRight = document.getElementById("bio_right");

const fontFam = document.getElementById("fontFam");
const fontSize = document.getElementById("fontSize");
const fontColor = document.getElementById("fontColor");
const aLeft = document.getElementById("aLeft");
const aCenter = document.getElementById("aCenter");
const aRight = document.getElementById("aRight");

function applyLive() {
  [bioLeft, bioRight].forEach(el => {
    el.style.fontFamily = fontFam.value;
    el.style.fontSize = fontSize.value + "px";
    el.style.color = fontColor.value;
  });
}
fontFam.oninput =
fontSize.oninput =
fontColor.oninput = applyLive;

aLeft.onclick = () => [bioLeft, bioRight].forEach(e => e.style.textAlign = "left");
aCenter.onclick = () => [bioLeft, bioRight].forEach(e => e.style.textAlign = "center");
aRight.onclick = () => [bioLeft, bioRight].forEach(e => e.style.textAlign = "right");

document.getElementById("saveBios").onclick = async () => {
  try {
    await supabaseClient.from("notes").insert([
      { content: JSON.stringify({ type:'bio', side:'left', text: bioLeft.innerText }) },
      { content: JSON.stringify({ type:'bio', side:'right', text: bioRight.innerText }) }
    ]);
    alert("Biografias salvas!");
  } catch (e) {
    console.error(e);
    alert("Erro ao guardar");
  }
};

/* ============================
          GALERIA
============================ */
const fileInput = document.getElementById("fileInput");
document.getElementById("addPhotoBtn").onclick = () => fileInput.click();

fileInput.onchange = async (e) => {
  const file = e.target.files[0];
  if (!file) return;

  const comp = await compressImg(file, 0.7);
  const name = Date.now() + "_" + file.name.replace(/\s/g,'');

  const { data, error } = await supabaseClient
    .storage.from("photos")
    .upload(name, comp);

  if (error) return alert(error.message);

  await supabaseClient.from("photos").insert([{ path: data.path }]);
  loadGallery();
};

function compressImg(file, q) {
  return new Promise(res => {
    const r = new FileReader();
    r.onload = e => {
      const img = new Image();
      img.onload = () => {
        const max = 2000;
        let w = img.width, h = img.height;
        if (w > max || h > max) {
          const ratio = Math.min(max/w, max/h);
          w *= ratio; h *= ratio;
        }
        const c = document.createElement("canvas");
        c.width = w; c.height = h;
        c.getContext("2d").drawImage(img,0,0,w,h);
        c.toBlob(b => res(b),"image/jpeg",q);
      };
      img.src = e.target.result;
    };
    r.readAsDataURL(file);
  });
}

async function loadGallery() {
  const { data } = await supabaseClient.from("photos").select("*").order("uploaded_at",{ascending:false});
  const grid = document.getElementById("galleryGrid");
  grid.innerHTML = "";

  if (!data || !data.length) {
    grid.innerHTML = "<p class='note'>Galeria vazia.</p>";
    return;
  }

  data.forEach(p => {
    const url = supabaseClient.storage.from("photos").getPublicUrl(p.path).data.publicUrl;
    const img = document.createElement("img");
    img.src = url;
    img.className = "thumb";
    grid.appendChild(img);
  });
}

/* ============================
            NOTAS
============================ */
const noteEditorWrap = document.getElementById("noteEditorWrap");
const noteEditor = document.getElementById("noteEditor");
const noteTitle = document.getElementById("noteTitle");

document.getElementById("newNoteBtn").onclick = () => {
  noteEditorWrap.style.display = "block";
  noteEditor.innerHTML = "";
  noteTitle.value = "";
};

document.getElementById("saveNote").onclick = async () => {
  const title = noteTitle.value.trim();
  const content = noteEditor.innerHTML.trim();
  const size = document.getElementById("noteSize").value;
  const color = document.getElementById("noteColor").value;

  if (!content) return alert("Escreve algo.");

  await supabaseClient.from("notes").insert([
    { title, content, meta: JSON.stringify({ size, color }) }
  ]);

  noteEditorWrap.style.display = "none";
  loadNotes();
};

async function loadNotes() {
  const { data } = await supabaseClient.from("notes").select("*").order("created_at",{ascending:false});
  const list = document.getElementById("notesList");
  list.innerHTML = "";

  if (!data || !data.length) {
    list.innerHTML = "<p class='note'>Sem notas ainda.</p>";
    return;
  }

  data.forEach(n => {
    const card = document.createElement("div");
    card.className = "noteCard";

    const meta = n.meta ? JSON.parse(n.meta) : { size:16,color:"#222" };

    card.innerHTML = `
      <div style="font-size:12px;color:var(--muted)">
        ${new Date(n.created_at).toLocaleString()}
      </div>
      <h3 style="margin:8px 0">${n.title || "Sem título"}</h3>
      <div style="font-size:${meta.size}px;color:${meta.color}">${n.content}</div>
    `;
    list.appendChild(card);
  });
}

/* ============================
         CALENDÁRIO
============================ */
let calDate = new Date();
let calView = "week";

document.getElementById("calPrev").onclick = () => navCal(-1);
document.getElementById("calNext").onclick = () => navCal(1);
document.getElementById("calView").onchange = (e) => {
  calView = e.target.value;
  renderCalendar();
};

function navCal(delta) {
  if (calView === "day") calDate.setDate(calDate.getDate() + delta);
  if (calView === "week") calDate.setDate(calDate.getDate() + delta*7);
  if (calView === "month") calDate.setMonth(calDate.getMonth() + delta);
  if (calView === "year") calDate.setFullYear(calDate.getFullYear() + delta);
  renderCalendar();
}

function startOfWeek(d) {
  const c = new Date(d);
  const day = c.getDay();
  const diff = c.getDate() - day + (day===0?-6:1);
  return new Date(c.getFullYear(), c.getMonth(), diff);
}

async function renderCalendar() {
  const grid = document.getElementById("calendarGrid");
  grid.innerHTML = "";
  const label = document.getElementById("calLabel");

  /* DIA */
  if (calView === "day") {
    const d = new Date(calDate);
    label.textContent = d.toLocaleDateString("pt-PT",{weekday:"long",day:"numeric",month:"long",year:"numeric"});

    const cell = document.createElement("div");
    cell.className = "day";
    cell.style.gridColumn = "1 / -1";
    cell.style.padding = "25px";
    cell.innerHTML = `
      <div style="font-weight:800;font-size:18px">${d.getDate()}</div>
      <div class="note">${d.toLocaleDateString("pt-PT",{weekday:"long"})}</div>
    `;
    cell.onclick = () => selectDay(d);
    grid.appendChild(cell);
    return;
  }

  /* SEMANA */
  if (calView === "week") {
    const start = startOfWeek(calDate);
    label.textContent = `Semana de ${start.toLocaleDateString("pt-PT")}`;

    const days = [];
    for (let i=0;i<7;i++){
      const dd = new Date(start);
      dd.setDate(start.getDate()+i);
      days.push(dd);
    }

    for (const d of days) {
      const el = document.createElement("div");
      el.className = "day";
      el.innerHTML = `
        <div style="color:var(--muted);font-size:13px">${d.toLocaleDateString("pt-PT",{weekday:"short"})}</div>
        <div style="font-weight:700;font-size:18px">${d.getDate()}</div>
      `;
      el.onclick = () => selectDay(d);
      grid.appendChild(el);
    }

    markEntries(days);
    return;
  }

  /* MÊS */
  if (calView === "month") {
    const y = calDate.getFullYear();
    const m = calDate.getMonth();
    label.textContent = calDate.toLocaleDateString("pt-PT",{month:"long",year:"numeric"});

    const first = new Date(y,m,1);
    const last = new Date(y,m+1,0);
    const startDay = (first.getDay()||7)-1;

    for (let i=0;i<startDay;i++){
      const ph = document.createElement("div");
      ph.style.opacity = "0";
      grid.appendChild(ph);
    }

    const days = [];
    for (let d=1; d<=last.getDate(); d++){
      const date = new Date(y,m,d);
      days.push(date);

      const el = document.createElement("div");
      el.className = "day";
      el.innerHTML = `
        <div style="font-size:12px;color:var(--muted)">${date.toLocaleDateString("pt-PT",{weekday:"short"})}</div>
        <div style="font-weight:700;font-size:18px">${d}</div>
      `;
      el.onclick = () => selectDay(date);
      grid.appendChild(el);
    }

    markEntries(days);
    return;
  }

  /* ANO */
  if (calView === "year") {
    label.textContent = calDate.getFullYear();

    for (let i=0;i<12;i++){
      const d = new Date(calDate.getFullYear(), i, 1);
      const el = document.createElement("div");
      el.className = "day";
      el.innerHTML = `<div style="font-weight:700">${d.toLocaleDateString("pt-PT",{month:"short"})}</div>`;
      el.onclick = () => {
        calDate = new Date(d);
        calView = "month";
        document.getElementById("calView").value = "month";
        renderCalendar();
      };
      grid.appendChild(el);
    }
  }
}

async function markEntries(days){
  const start = days[0].toISOString().slice(0,10);
  const end = days[days.length-1].toISOString().slice(0,10);

  const { data } = await supabaseClient
    .from("calendar_entries")
    .select("*")
    .gte("day_date", start)
    .lte("day_date", end);

  const cells = document.querySelectorAll(".day");

  days.forEach((d,i)=>{
    const key = d.toISOString().slice(0,10);
    if (data && data.find(x=>x.day_date===key))
      cells[i].classList.add("active");
  });
}

let selectedDay = null;
async function selectDay(d){
  selectedDay = d;
  const key = d.toISOString().slice(0,10);

  const { data } = await supabaseClient
    .from("calendar_entries")
    .select("*")
    .eq("day_date", key)
    .limit(1);

  document.getElementById("dayNote").value = data?.[0]?.text || "";
}

document.getElementById("saveDay").onclick = async () => {
  if (!selectedDay) return alert("Seleciona um dia.");

  const key = selectedDay.toISOString().slice(0,10);
  const txt = document.getElementById("dayNote").value.trim();

  const { data } = await supabaseClient
    .from("calendar_entries")
    .select("*")
    .eq("day_date", key)
    .limit(1);

  if (data?.length)
    await supabaseClient.from("calendar_entries").update({ text: txt }).eq("day_date", key);
  else
    await supabaseClient.from("calendar_entries").insert([{ day_date:key, text:txt }]);

  alert("Guardado!");
  renderCalendar();
};

/* ============================
          TEMPO
============================ */
const START = new Date("2025-09-17T22:00:00");

function diff(start, now){
  let y = now.getFullYear() - start.getFullYear();
  let m = now.getMonth() - start.getMonth();
  let d = now.getDate() - start.getDate();

  if (d<0){
    m--;
    d += new Date(now.getFullYear(),now.getMonth(),0).getDate();
  }
  if (m<0){
    y--; m+=12;
  }

  const sec = Math.floor((now-start)/1000);
  return {
    years:y,
    months:m,
    days:d,
    h: Math.floor(sec/3600)%24,
    min: Math.floor(sec/60)%60,
    s: sec%60,
    totalDays: Math.floor(sec/86400)
  };
}

function updateTempoUI(){
  const now = new Date();
  const t = diff(START, now);

  const ymd = [];
  if (t.years) ymd.push(`${t.years} ano${t.years>1?"s":""}`);
  if (t.months) ymd.push(`${t.months} mês${t.months>1?"es":""}`);
  if (t.days) ymd.push(`${t.days} dia${t.days>1?"s":""}`);

  document.getElementById("ymd").textContent = ymd.join(" • ") || "0 dias";
  document.getElementById("hms").textContent =
    `${String(t.h).padStart(2,"0")}:${String(t.min).padStart(2,"0")}:${String(t.s).padStart(2,"0")}`;

  document.getElementById("tempoSentence").textContent =
    `Para te lembrares quantos dias passaram desde que tomei a melhor decisão da minha vida... ` +
    `E que possamos voltar aqui e ver que os dias só aumentaram. ` +
    `Amo-te daqui até ao infinito e mais além ❤️  ` +
    `(${t.totalDays} dia${t.totalDays!==1?"s":""})`;
}

setInterval(updateTempoUI,1000);
updateTempoUI();

</script>
</body>
</html>

