<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Salvador ❤ Assunção</title>

<style>
:root{
  --pink:#d6336c;
  --bg1:#ffe6ef;
  --bg2:#fff9fc;
  --text:#2b2b2b;
  --muted:#704655;
}
body{
  margin:0;
  font-family:"Segoe UI",Arial,sans-serif;
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  color:var(--text);
  min-height:100vh;
}

/* TOPBAR */
.topbar{
  position:fixed;
  top:0;left:0;right:0;
  height:60px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 16px;
  backdrop-filter:blur(6px);
  background:#ffffffdd;
  z-index:5000;
}
.brand{
  font-weight:800;
  color:var(--pink);
  font-size:18px;
}
.hamb{
  width:44px;height:44px;
  background:#fff;
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  cursor:pointer;
  box-shadow:0 2px 8px rgba(0,0,0,0.1);
}
#currentPageName{
  font-size:14px;
  font-weight:700;
  color:var(--muted);
  margin-right:8px;
}

/* MENU LATERAL */
.drawer{
  position:fixed;
  top:0;
  right:-300px;
  width:300px;
  height:100vh;
  background:#fff;
  box-shadow:-10px 0 30px rgba(0,0,0,0.2);
  padding:20px;
  z-index:999999; /* CORRIGIDO */
  transition:0.3s ease;
}
.drawer.open{
  right:0;
}

/* NO TELEMÓVEL → MENU EM ECRÃ INTEIRO */
@media(max-width:720px){
  .drawer{
    width:100%;
    right:-100%;
    max-width:none;
  }
}

.menuitem{
  padding:12px;
  border-radius:8px;
  font-weight:700;
  cursor:pointer;
  margin-bottom:6px;
}
.menuitem:hover{
  background:rgba(214,51,108,0.08);
}

/* CONTAINER GERAL */
.container{
  padding:100px 16px 40px; /* mais espaço para não cortar nada */
  max-width:640px;
  margin:auto;
}

/* CARTÕES */
.card{
  background:#ffffffdd;
  padding:20px;
  border-radius:16px;
  box-shadow:0 6px 25px rgba(255,80,120,0.25);
  margin-bottom:20px;
}

.bigDate{
  font-size:26px;
  font-weight:800;
  color:var(--pink);
  text-align:center;
}
.smallTime{
  text-align:center;
  font-size:18px;
  color:var(--muted);
  margin-top:4px;
}

.page{ display:none; }
.page.active{ display:block; }

/* SOBRE NÓS */
.split{
  display:flex;
  gap:12px;
}
.col{
  flex:1;
  background:#fff;
  padding:12px;
  border-radius:12px;
  min-height:200px;
  border:1px solid #eee;
}

/* GALERIA */
.gallery{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(110px,1fr));
  gap:10px;
}
.thumb{
  width:100%;height:110px;
  object-fit:cover;
  border-radius:12px;
}

/* NOTAS */
.notes-list div{
  background:#fff;
  padding:10px;
  border-radius:10px;
  border:1px solid #eee;
  margin-bottom:8px;
}

/* CALENDÁRIO */
.week{
  display:flex;
  justify-content:space-between;
  gap:6px;
}
.day{
  flex:1;
  padding:10px;
  border-radius:8px;
  background:#fff;
  text-align:center;
  border:1px solid #eee;
  cursor:pointer;
}
.day.active{
  background:rgba(214,51,108,0.12);
}
</style>
</head>

<body>

<!-- TOPBAR -->
<div class="topbar">
  <div class="brand">Salvador ❤ Assunção</div>
  <div style="display:flex;align-items:center">
    <div id="currentPageName"></div>
    <div class="hamb" id="hamb">☰</div>
  </div>
</div>

<!-- MENU -->
<div class="drawer" id="drawer">
  <button id="closeDrawer" style="float:right;margin-bottom:10px;font-size:18px;background:none;border:none;cursor:pointer">✖</button>
  <h3 style="color:var(--pink)">Menu</h3>

  <div class="menuitem" data-page="home">Página Inicial</div>
  <div class="menuitem" data-page="come">Onde tudo começou</div>
  <div class="menuitem" data-page="sobre">Sobre Nós</div>
  <div class="menuitem" data-page="gal">Galeria</div>
  <div class="menuitem" data-page="notas">Notas</div>
  <div class="menuitem" data-page="cal">Calendário</div>
  <div class="menuitem" data-page="tempo">Tempo</div>
</div>

<div class="container">

<!-- LOGIN -->
<div id="loginCard" class="card">
  <h2 style="margin:0;color:var(--pink)">Entrar</h2>
  <p style="color:var(--muted)">Código secreto:</p>
  <input id="codeInput" placeholder="escreve o código..." style="padding:12px;width:100%;border-radius:12px;border:1px solid #ddd">
  <button id="enterBtn" style="margin-top:12px;padding:12px 20px;border-radius:12px;background:var(--pink);border:none;color:#fff;font-weight:bold;cursor:pointer;width:100%">Entrar</button>
  <div id="loginError" style="color:red;margin-top:10px;display:none">Código errado!</div>
</div>

<!-- APP -->
<div id="app" style="display:none">

  <!-- HOME -->
  <div id="page_home" class="page active">
    <div class="card">
      <div class="bigDate" id="dateNow"></div>
      <div class="smallTime" id="timeNow"></div>
    </div>
  </div>

  <!-- ONDE TUDO COMEÇOU -->
  <div id="page_come" class="page">
    <div class="card">
      <h2>Onde tudo começou</h2>
      <p style="color:var(--muted)">(Escreves aqui depois)</p>
    </div>
  </div>

  <!-- SOBRE NÓS -->
  <div id="page_sobre" class="page">
    <div class="card">
      <h2>Sobre Nós</h2>
      <div class="split" style="margin-top:14px">
        <div class="col">
          <h3>Sassá</h3>
          <textarea id="bio_left" style="width:100%;min-height:120px;border-radius:10px;border:1px solid #eee"></textarea>
        </div>
        <div class="col">
          <h3>Assunção</h3>
          <textarea id="bio_right" style="width:100%;min-height:120px;border-radius:10px;border:1px solid #eee"></textarea>
        </div>
      </div>
      <button id="saveBios" style="margin-top:14px;padding:12px 20px;border:none;border-radius:12px;background:var(--pink);color:#fff;font-weight:bold;width:100%">Guardar</button>
    </div>
  </div>

  <!-- GALERIA -->
  <div id="page_gal" class="page">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h2>Galeria</h2>
        <button id="addPhotoBtn" style="padding:10px 16px;border:none;border-radius:12px;background:var(--pink);color:#fff;font-weight:bold">+</button>
      </div>
      <input type="file" id="fileInput" accept="image/*" style="display:none">
      <div class="gallery" id="galleryGrid" style="margin-top:14px"></div>
    </div>
  </div>

  <!-- NOTAS -->
  <div id="page_notas" class="page">
    <div class="card">
      <h2>Notas</h2>
      <textarea id="noteInput" placeholder="Escreve algo..." style="width:100%;min-height:100px;border-radius:12px;border:1px solid #ddd"></textarea>
      <button id="saveNote" style="margin-top:12px;padding:12px 20px;border:none;border-radius:12px;background:var(--pink);color:#fff;font-weight:bold;width:100%">Guardar Nota</button>
      <div id="notesList" class="notes-list" style="margin-top:14px"></div>
    </div>
  </div>

  <!-- CALENDÁRIO -->
  <div id="page_cal" class="page">
    <div class="card">
      <h2>Calendário</h2>
      <div style="text-align:center;color:var(--muted)" id="monthLabel"></div>
      <div class="week" id="weekGrid" style="margin-top:14px"></div>
      <textarea id="dayNote" style="width:100%;min-height:100px;border-radius:12px;border:1px solid #ddd;margin-top:14px"></textarea>
      <button id="saveDay" style="margin-top:10px;padding:12px 20px;border:none;border-radius:12px;background:var(--pink);color:#fff;font-weight:bold;width:100%">Guardar Dia</button>
    </div>
  </div>

  <!-- TEMPO -->
  <div id="page_tempo" class="page">
    <div class="card">
      <h2>Tempo</h2>
      <div class="bigDate" id="ymd"></div>
      <div class="smallTime" id="hms"></div>
    </div>
  </div>

</div></div>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
/* CONFIG SUPABASE */
const SUPABASE_URL = "https://qtzlyowxjqdsswyxcmzu.supabase.co";
const SUPABASE_ANON_KEY =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF0emx5b3d4anFkc3N3eXhjbXp1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2MDc1MDUsImV4cCI6MjA4MDE4MzUwNX0.iLb7C7x-qyzY58SHd_n_Fdc2RkVy2hNBkf-n41st02c";

const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* LOGIN */
document.getElementById("enterBtn").onclick = () => {
  if(document.getElementById("codeInput").value === "sasiboy"){
    document.getElementById("loginCard").style.display="none";
    document.getElementById("app").style.display="block";
  } else {
    document.getElementById("loginError").style.display="block";
  }
};

/* MENU */
const drawer=document.getElementById("drawer");
document.getElementById("hamb").onclick=()=>drawer.classList.add("open");
document.getElementById("closeDrawer").onclick=()=>drawer.classList.remove("open");
document.querySelectorAll(".menuitem").forEach(el=>{
  el.onclick=()=>{
    drawer.classList.remove("open");
    showPage(el.dataset.page);
  };
});

function showPage(p){
  document.querySelectorAll(".page").forEach(pg=>pg.classList.remove("active"));
  document.getElementById("page_"+p).classList.add("active");
  document.getElementById("currentPageName").textContent=p.charAt(0).toUpperCase()+p.slice(1);
  if(p==="gal") loadGallery();
  if(p==="notas") loadNotes();
  if(p==="cal") renderWeek(0);
}

/* HOME CLOCK */
function updateClock(){
  let d=new Date();
  document.getElementById("dateNow").textContent=
    d.toLocaleDateString("pt-PT");
  document.getElementById("timeNow").textContent=
    d.toLocaleTimeString("pt-PT",{hour:'2-digit',minute:'2-digit'});
}
setInterval(updateClock,1000);
updateClock();

/* TEMPO */
const START=new Date("2025-09-17T22:00:00");
function updTempo(){
  let now=new Date();
  let diff=now-START;
  let s=Math.floor(diff/1000);
  let years=now.getFullFullYear?now.getFullYear()-START.getFullYear():now.getFullYear()-START.getFullYear();
  let yearsDiff=now.getFullYear()-START.getFullYear();
  years = yearsDiff;
  let months=now.getMonth()-START.getMonth();
  if(months<0){years--;months+=12;}
  let anchor=new Date(START.getFullYear()+years,START.getMonth()+months,START.getDate());
  if(anchor>now){
    months--; if(months<0){years--;months+=12;}
    anchor=new Date(START.getFullYear()+years,START.getMonth()+months,START.getDate());
  }
  let days=Math.floor((now-anchor)/(1000*60*60*24));
  let hrs=Math.floor(s/3600)%24;
  let mins=Math.floor(s/60)%60;
  let secs=s%60;

  document.getElementById("ymd").textContent=
    `${years} anos • ${months} meses • ${days} dias`;
  document.getElementById("hms").textContent=
    `${hrs} horas, ${mins} minutos, ${secs} segundos`;
}
setInterval(updTempo,1000); updTempo();

/* GALERIA */
document.getElementById("addPhotoBtn").onclick=()=>document.getElementById("fileInput").click();

document.getElementById("fileInput").onchange=async(e)=>{
  const file=e.target.files[0];
  if(!file) return;

  const compressed=await compressImg(file,0.6);

  const filePath=Date.now()+"_"+file.name.replace(/\s/g,"_");

  let { data, error } = await supabase.storage.from("photos").upload(filePath, compressed);
  if(error){ alert("Erro a enviar foto"); return; }

  await supabase.from("photos").insert([{path:data.path}]);

  loadGallery();
};

async function compressImg(file,quality){
  return new Promise(res=>{
    const reader=new FileReader();
    reader.onload=ev=>{
      const img=new Image();
      img.onload=()=>{
        const canvas=document.createElement("canvas");
        const ctx=canvas.getContext("2d");

        canvas.width=img.width;
        canvas.height=img.height;
        ctx.drawImage(img,0,0);

        canvas.toBlob(blob=>res(blob),"image/jpeg",quality);
      };
      img.src=ev.target.result;
    };
    reader.readAsDataURL(file);
  });
}

async function loadGallery(){
  const { data } = await supabase.from("photos").select("*").order("uploaded_at",{ascending:false});
  const grid=document.getElementById("galleryGrid");
  grid.innerHTML="";
  if(!data || data.length===0){
    grid.innerHTML="<p style='color:var(--muted)'>Galeria vazia.</p>";
    return;
  }
  data.forEach(p=>{
    const url=supabase.storage.from("photos").getPublicUrl(p.path).data.publicUrl;
    const img=document.createElement("img");
    img.src=url;
    img.className="thumb";
    grid.appendChild(img);
  });
}

/* NOTAS */
document.getElementById("saveNote").onclick=async()=>{
  const txt=document.getElementById("noteInput").value.trim();
  if(!txt) return;
  await supabase.from("notes").insert([{content:txt}]);
  document.getElementById("noteInput").value="";
  loadNotes();
};

async function loadNotes(){
  const { data } = await supabase.from("notes").select("*").order("created_at",{ascending:false});
  const list=document.getElementById("notesList");
  list.innerHTML="";
  if(!data||data.length===0){
    list.innerHTML="<p style='color:var(--muted)'>sem notas ainda</p>";
    return;
  }
  data.forEach(n=>{
    const div=document.createElement("div");
    div.innerHTML=`<div style="font-size:12px;color:var(--muted)">${new Date(n.created_at).toLocaleString()}</div>${n.content}`;
    list.appendChild(div);
  });
}

/* CALENDÁRIO */
let weekOffset=0;

function startOfWeek(d){
  const day=d.getDay();
  const diff=d.getDate()-day+(day===0?-6:1);
  return new Date(d.getFullYear(),d.getMonth(),diff);
}

function renderWeek(off){
  weekOffset=off;
  const now=new Date();
  const base=startOfWeek(now);
  base.setDate(base.getDate()+off*7);

  const days=[];
  for(let i=0;i<7;i++){
    days.push(new Date(base.getFullYear(),base.getMonth(),base.getDate()+i));
  }

  document.getElementById("monthLabel").textContent=
    days[0].toLocaleString("pt-PT",{month:"long"})+" "+days[0].getFullYear();

  const grid=document.getElementById("weekGrid");
  grid.innerHTML="";

  days.forEach(d=>{
    const el=document.createElement("div");
    el.className="day";
    el.innerHTML=`<div style='color:var(--muted);font-size:12px'>
    ${["S","T","Q","Q","S","S","D"][d.getDay()]}</div><div>${d.getDate()}</div>`;
    el.onclick=()=>selectDay(d);
    grid.appendChild(el);
  });

  markEntries(days);
}

async function markEntries(days){
  const start=days[0].toISOString().slice(0,10);
  const end=days[6].toISOString().slice(0,10);

  const { data }=await supabase.from("calendar_entries")
    .select("*")
    .gte("day_date",start)
    .lte("day_date",end);

  const grid=document.getElementById("weekGrid").children;
  days.forEach((d,i)=>{
    const dd=d.toISOString().slice(0,10);
    if(data.find(x=>x.day_date===dd)) grid[i].classList.add("active");
  });
}

let selectedDay=null;

async function selectDay(d){
  selectedDay=d;
  const key=d.toISOString().slice(0,10);
  const { data }=await supabase.from("calendar_entries")
    .select("*").eq("day_date",key).limit(1);

  document.getElementById("dayNote").value =
    data&&data.length? data[0].text : "";
}

document.getElementById("saveDay").onclick=async()=>{
  if(!selectedDay){alert("Escolhe um dia");return;}
  const key=selectedDay.toISOString().slice(0,10);
  const txt=document.getElementById("dayNote").value.trim();

  const { data }=await supabase.from("calendar_entries")
    .select("*").eq("day_date",key).limit(1);

  if(data&&data.length){
    await supabase.from("calendar_entries").update({text:txt}).eq("day_date",key);
  }else{
    await supabase.from("calendar_entries").insert([{day_date:key,text:txt}]);
  }

  alert("Guardado!");
  renderWeek(weekOffset);
};

</script>

</body>
</html>
